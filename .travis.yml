env:
  - RCHECK_SKIP_COVERAGE=1

os: linux
arch: arm64-graviton2
language: shell

services:
  - docker

branches:
  only:
    - main

install:
  - curl -sSL https://raw.githubusercontent.com/acidgenomics/Rcheck/master/install | bash

jobs:
  include:
    - stage: test
      name: "bioc-release"
      script: image="acidgenomics/r-acidgenomes" tag="bioc-release" ./.Rcheck/docker
    - stage: test
      name: "bioc-oldrel"
      script: image="acidgenomics/r-acidgenomes" tag="bioc-oldrel" ./.Rcheck/docker
    - stage: test
      name: "bioc-devel"
      script: image="acidgenomics/r-acidgenomes" tag="bioc-devel" ./.Rcheck/docker
  allow_failures:
    - name: "bioc-devel"
  allow_failures:
    - name: "bioc-devel"
  fast_finish: true

after_failure:
  - ./.Rcheck/docker-failure

notifications:
  email:
    recipients:
      - mike@steinbaugh.com
    on_success: change
    on_failure: change
