## FIXME Add coverage for versioned ensembl identifiers.

## FIXME Move this to main tests when finished.

## FIXME Need to figure out ensembl genes that have tricky multi-mapping
## that doesn't match Hgnc.
##
## FIXME Need to figure out ncbi genes that have tricky multi-mapping that
## doesn't match Hgnc.

## Ensembl identifiers that multi-map:
## [1] "ENSG00000004866" "ENSG00000063587" "ENSG00000065615"
## [4] "ENSG00000076554" "ENSG00000088298" "ENSG00000090857"

test_that("character : all HGNC genes", {
    hgnc <- Hgnc()
    object <- sort(unique(na.omit(hgnc[["ensemblGeneId"]])))
    expect_error(
        object = EnsemblToNcbi(
            object = object,
            organism = "Homo sapiens"
        ),
        regexp = "match failures"
    )
})

## 1   ENSG00000111215       5554
## 2   ENSG00000169627     552900
## 3   ENSG00000176797      55894
## 4   ENSG00000177693  124906935
## 5   ENSG00000178934       3963
## 6   ENSG00000180525  124900286
## 7   ENSG00000183305       4101
## 8   ENSG00000187621  124903372
## 9   ENSG00000188660  102724398
## 10  ENSG00000189064      26749
## 11  ENSG00000199226  124900488
## 12  ENSG00000200434  124907486
## 13  ENSG00000200790  124900632
## 14  ENSG00000201806  124900516
## 15  ENSG00000204054  124900275
## 16  ENSG00000204929  124906016
## 17  ENSG00000205611  101928906
## 18  ENSG00000206588  124904613
## 19  ENSG00000206828  124904627
## 20  ENSG00000206906  124905168
## 21  ENSG00000207289  124905522
## 22  ENSG00000210151  113219467
## 23  ENSG00000211689     445347
## 24  ENSG00000213999       4207
## 25  ENSG00000214049  124900418
## 26  ENSG00000214783      84820
## 27  ENSG00000214900     196913
## 28  ENSG00000215269       2576
## 29  ENSG00000215483     400123
## 30  ENSG00000222225  124906683
## 31  ENSG00000223403     378881
## 32  ENSG00000223646  101928012
## 33  ENSG00000223734  124900607
## 34  ENSG00000224609     729467
## 35  ENSG00000225177  124900217
## 36  ENSG00000226023     255313
## 37  ENSG00000227110  101927394
## 38  ENSG00000228262  104355287
## 39  ENSG00000228636  124902542
## 40  ENSG00000228695  107987423
## 41  ENSG00000228999  124908056
## 42  ENSG00000230373     642402
## 43  ENSG00000231187  102724593
## 44  ENSG00000231527  105379444
## 45  ENSG00000232624     283080
## 46  ENSG00000233008  101927560
## 47  ENSG00000233098     339260
## 48  ENSG00000233132  124906723
## 49  ENSG00000233491  100128317
## 50  ENSG00000233780  101930748
## 51  ENSG00000234807  101926907
## 52  ENSG00000235438  105370105
## 53  ENSG00000235885  101927661
## 54  ENSG00000236125     392188
## 55  ENSG00000236172  102800315
## 56  ENSG00000236362       2574
## 57  ENSG00000237850     440243
## 58  ENSG00000238653  124904732
## 59  ENSG00000238782  124906135
## 60  ENSG00000238884  124902076
## 61  ENSG00000239149     677882
## 62  ENSG00000241104     284344
## 63  ENSG00000241956  102546299
## 64  ENSG00000242147  102723629
## 65  ENSG00000242296  124905442
## 66  ENSG00000245146  124900193
## 67  ENSG00000245552  100129203
## 68  ENSG00000245694  101927480
## 69  ENSG00000247081  105369147
## 70  ENSG00000248278  105371814
## 71  ENSG00000248489  100289230
## 72  ENSG00000248538     157273
## 73  ENSG00000248690  124906789
## 74  ENSG00000249740  101926904
## 75  ENSG00000250748  105369187
## 76  ENSG00000251705  124907582
## 77  ENSG00000251970  124905307
## 78  ENSG00000252429  124904769
## 79  ENSG00000253054  124901190
## 80  ENSG00000253948  124900254
## 81  ENSG00000254166  103164619
## 82  ENSG00000254451  100130268
## 83  ENSG00000255595  101927531
## 84  ENSG00000255760  105369725
## 85  ENSG00000256282  112268073
## 86  ENSG00000258537     145438
## 87  ENSG00000258636  124907392
## 88  ENSG00000260081  105373383
## 89  ENSG00000260128      89838
## 90  ENSG00000260788  105371366
## 91  ENSG00000261241  112267895
## 92  ENSG00000261971  124900372
## 93  ENSG00000266256     284276
## 94  ENSG00000267308  124908074
## 95  ENSG00000267452     440446
## 96  ENSG00000269136     641367
## 97  ENSG00000270722  124904619
## 98  ENSG00000271171  105372377
## 99  ENSG00000274210  124904621
## 100 ENSG00000274428  124904634
## 101 ENSG00000274512     729873
## 102 ENSG00000274659  124906976
## 103 ENSG00000275113     729428
## 104 ENSG00000275239  105379447
## 105 ENSG00000276085       6349
## 106 ENSG00000277422  100288527
## 107 ENSG00000280263     440888
## 108 ENSG00000280623  124900476
## 109 ENSG00000281880     440034
## 110 ENSG00000285219  100506207
## 111 ENSG00000285551  124902436

test_that("Mapping consistency between HGNC and Ensembl", {
    hgnc <- Hgnc()
    ens <- makeGRangesFromEnsembl(organism = "Homo sapiens")
    x <- EnsemblToNcbi(hgnc)
    x <- as(x, "DFrame")
    metadata(x) <- list()
    rownames(x) <- NULL
    y <- EnsemblToNcbi(ens)
    y <- as(y, "DFrame")
    metadata(y) <- list()
    rownames(y) <- NULL
    genes <- sort(intersect(x[[1L]], y[[1L]]))
    x <- x[match(genes, table = x[[1L]]), ]
    y <- y[match(genes, table = y[[1L]]), ]
    expect_identical(x, y)
    ## > y[which(x[[2]] != y[[2]]), ]
})
